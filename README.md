# Digital Inspector

Автоматическая детекция подписей, печатей и QR-кодов на документах. Веб‑интерфейс (HTML/CSS/JS) раздаётся из Flask, инференс на YOLOv8 (Ultralytics).

Содержание
- О проекте
- Возможности
- Технический стек
- Как это работает
- Требования
- Установка и запуск (Windows PowerShell)
- Использование и API
- Структура проекта

О проекте
- Single‑model детектор: одна модель YOLOv8 для всех классов (`signature`, `stamp`, `qr_code`).
- Детекция запускается на оригинальном и инвертированном изображениях, затем результаты объединяются по IoU — это повышает чувствительность к тёмным подписям/штампам.
- Поддерживаются изображения и многостраничные PDF. Для PDF формируется склеенный предпросмотр, а также сохраняются результаты по страницам.
- Экспорт результатов: PDF c разметкой, JSON со всеми детекциями и кропами.

Возможности
- Загрузка изображений и PDF drag‑and‑drop на странице `Task.html`.
- Превью с боксами и счётчиком по классам.
- Кропы найденных элементов и скачивание ZIP‑архивов с прозрачным фоном отдельно для подписей, печатей и QR.
- Сохранение итогового PDF и JSON на сервере с быстрыми ссылками на скачивание.

Технический стек
- Backend: Flask + Python 3.11, OpenCV, NumPy, Ultralytics YOLOv8.
- Frontend: чистый HTML/CSS/JS; без сборщика.
- Форматы: изображения (JPG/PNG/WEBP/BMP/TIFF/HEIC), PDF.

Как это работает
1) Загрузка файла в `/detect` (изображение или PDF).
2) Предобработка: CLAHE в пространстве LAB для повышения контраста.
3) Две прогонки детекции: на оригинале и на инверсии изображения.
4) Слияние детекций с удалением дублей на основе IoU и доверия.
5) Генерация предпросмотра, кропов и сохранение PDF/JSON в `outputs/`.

Требования
- Python 3.11 (рекомендовано) на Windows.
- Видеокарта не обязательна (CPU поддерживается).

Установка и запуск (Windows PowerShell)
```powershell
# 1) Клонирование
git clone https://github.com/Farabbbek/InnovateX-hack.git
cd InnovateX-hack

# 2) Виртуальное окружение
py -3.11 -m venv .venv
.\.venv\Scripts\Activate.ps1

# 3) Зависимости
pip install -r requirements.txt

# 4) Вес модели
# По умолчанию берётся путь из back/config.py -> models/yolov8m_best2.pt
# Поместите файл весов по этому пути или измените переменную MODEL_PATH в back/config.py

# 5) Запуск backend (фронтенд раздаётся отсюда же)
.\.venv\Scripts\python.exe .\back\app.py

# Если в терминале когда-то появляется лишняя кириллическая "с" перед путями,
# используйте запуск через переменную:
$py = "C:\\Users\\FARAB\\InnovateX-hack\\.venv\\Scripts\\python.exe"; & $py "C:\\Users\\FARAB\\InnovateX-hack\\back\\app.py"
```

После запуска:
- Главная: http://127.0.0.1:5000/
- Страница детекции: http://127.0.0.1:5000/Task.html

Использование
- В веб-интерфейсе загрузите файл изображения или PDF. Для PDF все страницы будут обработаны и склеены для предпросмотра; кропы объектов возвращаются в ответе и доступны для скачивания.

Минимальный пример API
```python
import requests

with open('document.jpg', 'rb') as f:
    r = requests.post('http://127.0.0.1:5000/detect', files={'image': f})
print(r.json())
```

Основные эндпоинты
- GET `/health` — проверка статуса
- POST `/detect` — детекция на одном изображении или многостраничном PDF
- GET `/download/<filename>` — скачать PDF с разметкой
- GET `/download_json/<filename>` — скачать JSON с результатом
- GET `/stats` — краткая статистика сохранённых результатов

Структура проекта (важное)
```
back/            Flask + детектор + утилиты
frontend/        index.html, Task.html и статика
models/          файлы весов модели (не хранятся в git)
dataset/         data.yaml (остальное игнорируется)
outputs/         результаты (игнорируются)
runs/            артефакты обучения YOLO (игнорируются)
```

Примечания
- Репозиторий настроен на чистый git: веса, датасеты и артефакты не коммитятся (.gitignore).
- Для смены модели измените `MODEL_PATH` в `back/config.py`.
- Если потребуется Docker/служба Windows — можно добавить позже по запросу.

